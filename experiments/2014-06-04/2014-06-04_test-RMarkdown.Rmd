Testing R Markdown with Allegro Analysis
========================================================
2014-06-04
-------------------------------------------
This is my first R Mardown document. I will be attempting to run and create a simple analysis
for the Allegro CODP+Cancer project. 

When you click the **Knit HTML** button a web page will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Running one model: BATCH + RIN + AGEcalc}
# AllegroSetup.R uses an RDS file with 800+ samples (biological replicates) and without QC
source("/protected/projects/pulmarray/Allegro/COPD_Cancer/scripts/AllegroSetup.R")

# remove duplicate samples for now arbitrarily
celNames <- apply(X=as.data.frame(sampleNames(exprData)), 1, strsplit, split="_")
temp <- character(length(sampleNumber(exprData)))
for(i in 1:length(celNames)){ temp[i] <- celNames[[i]]$'sampleNames(exprData)'[5]}
inds <- match(unique(temp), temp)
exprData <- exprData[,inds]

# I can put my analysis here:

# Define color schemes, based on factors
bluered <- colorRampPalette(c("blue","white","red"))(256)

cancer_colors <- c("0"="black", "1"="red");
copd_colors <- c("0"="bisque", "1"="blue");
gender_colors <- c("0"="blue", "1"="pink");
smoking_colors <- c("1"="grey", "2"="white");
batch_colors <- c("12"="red", "13"="blue", "14"="orange", "15"="green", "16"="black");
copdca_colors <- c("0"="green", "1"="red", "2"="blue", "3"="yellow")

# Define the covariate to use
covars <- list(list("BATCH", "RIN", "AGEcalc"),
               list("SMKc", "COPD_EM_Bronchitisc", "FinalCaDXc", "FinalCaDXc*COPD_EM_Bronchitisc"))

exprData <- removeFactorLevel(exprData, "COPD_EM_Bronchitisc", "DK")
exprData <- removeFactorLevel(exprData, "FinalCaDXc", "DK")

# define an indicator/group factor in the phenotype data (values 1-4, healthy, copd, cancer, both)
exprData <- calcIndicator(exprData, "COPD_EM_Bronchitisc")

test1 <- analyze_covariate_lists(exprData, covars[[2]])


```

A heatmap representing the genes significant for COPD*Cancer from a model that also includes
smoking status (former or current):

```{r TestFigure, fig.width=7, fig.height=6}
# define the indices of the genes of interest to print in a heatmap

# there are 480 genes that survive FDR correction at FDR < 0.2
inds2 <- test1$cutoffs_fdr[[2]]$'COPD_EM_Bronchitisc1:FinalCaDXc1'

# there are 127 genes that survive FDR correction at FDR < 0.1
inds3 <- test1$cutoffs_fdr[[3]]$'COPD_EM_Bronchitisc1:FinalCaDXc1'


clabels <- cbind("Group"=copdca_colors[exprData$indicator],
                 "Cancer"=cancer_colors[exprData$FinalCaDXc],
                 "COPD"=copd_colors[exprData$COPD_EM_Bronchitisc])

#heatmap3(exprs(exprData)[inds,], col=bluered, colSideColors=clabels, col.clustering="semisupervised")
heatmap3(exprs(exprData)[inds2,], col=bluered, ColSideColors=clabels, col.clustering=exprData$indicator, main=paste(length(inds2), "genes at FDR < 0.2 for COPD*Cancer interaction"))

heatmap3(exprs(exprData)[inds3,], col=bluered, ColSideColors=clabels, col.clustering=exprData$indicator, main=paste(length(inds3), "genes at FDR < 0.1 for COPD*Cancer interaction"))

```


### I'd like to try running this with just patients with PFTs

```{r Running model on only patients with PFT data available}

pftInds <- which(!is.na(exprData$RATIOc))
exprDataPFT <- exprData[,pftInds]






```
I'd also like to try running this by including only those patients with severe COPD
i.e. decreasing the cutoffs by which we define COPD

