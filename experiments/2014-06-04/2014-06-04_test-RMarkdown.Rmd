Testing R Markdown with Allegro Analysis
========================================================
2014-06-04
-------------------------------------------
This is my first R Mardown document. I will be attempting to run and create a simple analysis
for the Allegro CODP+Cancer project. 

When you click the **Knit HTML** button a web page will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Running one model: BATCH + RIN + AGEcalc}
# AllegroSetup.R uses an RDS file with 800+ samples (biological replicates) and without QC
source("/protected/projects/pulmarray/Allegro/COPD_Cancer/scripts/AllegroSetup.R")

# I can put my analysis here:

# Define color schemes, based on factors
bluered <- colorRampPalette(c("blue","white","red"))(256)

cancer_colors <- c("0"="black", "1"="red");
copd_colors <- c("0"="bisque", "1"="blue");
gender_colors <- c("0"="blue", "1"="pink");
smoking_colors <- c("1"="grey", "2"="white");
batch_colors <- c("12"="red", "13"="blue", "14"="orange", "15"="green", "16"="black");
copdca_colors <- c("0"="green", "1"="red", "2"="blue", "3"="yellow")

# Define the covariate to use
covars <- list(list("BATCH", "RIN", "AGEcalc"),
               list("COPD_EM_Bronchitisc", "FinalCaDXc", "FinalCaDXc*COPD_EM_Bronchitisc"))

exprData <- removeFactorLevel(exprData, "COPD_EM_Bronchitisc", "DK")
exprData <- removeFactorLevel(exprData, "FinalCaDXc", "DK")

# define an indicator/group factor in the phenotype data (values 1-4, healthy, copd, cancer, both)
ind1 <- which(exprData$FinalCaDXc==0 & exprData$COPD_EM_Bronchitisc==0)
ind2 <- which(exprData$FinalCaDXc==0 & exprData$COPD_EM_Bronchitisc==1)
ind3 <- which(exprData$FinalCaDXc==1 & exprData$COPD_EM_Bronchitisc==0)
ind4 <- which(exprData$FinalCaDXc==1 & exprData$COPD_EM_Bronchitisc==1)
indicator <- numeric(sampleNumber(exprData))
indicator[ind1] <- 1
indicator[ind2] <- 2
indicator[ind3] <- 3
indicator[ind4] <- 4
indicator <- factor(indicator)
exprData$indicator <- indicator

test1 <- analyze_covariate_lists(exprData, covars[[2]])


```

You can also embed plots, for example:

```{r TestFigure, fig.width=7, fig.height=6}
# define the indices of the genes of interest to print in a heatmap
inds <- test1$cutoffs_fdr[[3]]$'COPD_EM_Bronchitisc1:FinalCaDXc1'


clabels <- cbind("Group"=copdca_colors[exprData$indicator],
                 "Cancer"=cancer_colors[exprData$FinalCaDXc],
                 "COPD"=copd_colors[exprData$COPD_EM_Bronchitisc])

#heatmap3(exprs(exprData)[inds,], col=bluered, colSideColors=clabels, col.clustering="semisupervised")
heatmap3(exprs(exprData)[inds,], col=bluered, ColSideColors=clabels, col.clustering=exprData$indicator)



```



