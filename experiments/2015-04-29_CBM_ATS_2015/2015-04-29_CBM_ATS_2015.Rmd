COPD:Cancer Interaction, ATF4, EMT, ECM
===============================================================================
`r Sys.Date()`
---------------------------------------------

I'm going to go back to the interaction list generated by the mean of t-statistics from the 3 models motivated by Katie's work.
I will generate a ranked list and genes lists at various FDR thresholds.
From there I will use GSEA to check for enrichment of the EMT signature from the NSCLC paper, the ATF4 signature from Ben, and the tumor signal from Katie

I need to read the EMT paper. I would also like to find an ECM gene signature
Look at the gastric cancer EMT, UPR paper
Regenerate PC plot of all cancers ([from Byers EMT paper](http://www.ncbi.nlm.nih.gov/pubmed/23091115))
EGFR mutations were only in the epithelial group, while KRAS mutations were more common in the mesenchymal group
Eventually could recreate their anlaysis by findings genes correlated with at least one of the 4 EMT markers, E-cadherin (CDH1), vimentin (VIM), N-cadherin (CDH2), or fibronectin (FN1)
The [gastric paper](http://www.ncbi.nlm.nih.gov/pubmed/25502090) showed that severe hypoxia induced EMT of gastric cancer cells. Additionally, PERK, ATF4, ATF6 were all elevated in cells under severe hypoxia (this is their purpose, no?). Knockdown of PERK, ATF4, or ATF6 impeded EMT of gastric cancer cells induced by severe hypoxia. E-cadherin decreased from normoxia to hypoxia to severe hypoxia, while vimentin increased conversely. TGF-beta was also increased by severe hypoxia, but its increase was blocked by knockdown of the 3 UPR genes. TGF-beta increase in severe hypoxia led to activation of SMAD2/3 and PI3K/Akt signaling.
Interesting to look at these genes (PERK, ATF4, ATF6, CHD1, CDH2, FN1, VIM, SMAD2/3, PI3K/Akt pathways), especially in former smokers by disease

<h4>CBM Presentation<h4>
Will have to go into some background but nothing too extensive. Take some from quals. Also add the Powell UK study and reference to Young '09 and Skillrud '86.



1. generate 3x COPD:Cancer interaction models
2. Generate ranked list for each of 3x models
3. Create a merged ranked list by taking the mean of the 3 t-stats
4. Optionally, take the t-stat of the t-stats
5. Generate gene signature from COPD:Cancer interaction
5. Visualize genes of signature by heatmap
5. Use ATF4 Data to generate ATF4 up/down signatures
6. Generate ranked list for ATF4
7. Use EMT gene signature and visualize cancers only
8. Test EMT signature by chi-squared test
9. Find ECM gene(s) signature
10. Look at Katie's gene signature in the tumor and compare to the airway
11. GSEA the interaction into ATF4, EMT, and tumor signatures or vice-versa
12. visualize the signatures by heatmap and PCA, especially in cancers

ECM genes related to COPD]()
  
```{r defineFunctions, include=FALSE}
foldChange <- function(eset, groups, genes){
  apply(exprs(eset)[genes, groups==0], 1, mean) - 
    apply(exprs(eset)[genes, groups==1], 1, mean)
}

medianFilter <- function(eset){
  md <- median(exprs(eset))
  passFilter <- logical(featureNumber(eset))
  for(i in 1:featureNumber(eset)){
    passFilter[i] <- sum(exprs(eset)[i, ] > md) > 0
  }
  
  eset <- eset[passFilter, ]
  return(eset)
  
}

saveGeneList <- function(analysis, filename=paste(Sys.Date(), "Temp", analysis$name, ".txt", sep="")){
  
  write.table(analysis$geneSymbols, file=filename, quote=FALSE,row.names=FALSE, col.names=FALSE)

}

saveRankedList <- function(fit, varColInd, filename = "tempRankedList"){
  filename = paste(paste(Sys.Date(), colnames(fit$t)[varColInd], filename, sep="_"), "rnk", sep=".")
  print(filename)
  temp <- data.frame(geneSymbols = fit$genes$Symbol, ts = fit$t[, varColInd])
  write.table(temp, file=filename, row.names=FALSE, quote=FALSE, col.names=TRUE, sep="\t", eol="\n")
  
  
}

saveGeneSet <- function(fit, inds, filename = "tempGeneSet", geneSetName="GeneSet", description=""){
  filename = paste(paste(Sys.Date(), filename, sep="_"), "gmx", sep=".")
  print(filename)
  temp <- data.frame(geneSymbols=c(geneSetName, description, fit$genes$Symbol[inds]))
  write.table(temp, file=filename, row.names=FALSE, quote=FALSE, col.names=FALSE)
  
}
```

```{r setup, eval=TRUE, echo=TRUE, include=FALSE, results='hide'}

setwd("/protected/projects/pulmarray/Allegro/COPD_Cancer/experiments/2015-04-29_CBM_ATS_2015/")
source("/protected/projects/pulmarray/Allegro/COPD_Cancer/scripts/AllegroSetup.R")
# fix the one patient with wonky data
# eventually this should just be saved in the RDS file
holdEset <- eset
holdEset$FEV1Pc[holdEset$FEV1Pc==89.2] <- 0.892

emt_genes <- read.csv("/protected/projects/pulmarray/Allegro/COPD_Cancer/geneSubsets/emt_gene_symbols_byers_2013.csv", header=FALSE)
temp <- as.factor(unique(as.character(emt_genes$V1)))
emt_genes <- data.frame("EMT_Genes" = temp)

GOLD_colors = c("0" = "gray100", "1" = "gray75", "2" = "gray50", "3" = "gray25", "4" = "black")

# load ATF4 BEASB2 gene perturbation data for analysis
atf4_data <- readRDS("/protected/projects/pulmarray/Allegro/ATF4/ATF4data_2015MAR17_ExpressionSet.rds")
library(znorm)
library(diptest)



```

```{r cleanup}

# Remaining question - should we keep or remove the COPD GOLD Status 1 patients? i.e. mild disease
# What about patients using or their charts indicating they have used corticosteroids?
esetClean <- holdEset
esetClean <- cleanNAForAnalysis(esetClean, "COPD2_R7")
esetClean <- cleanNAForAnalysis(esetClean, "RATIOc")
esetClean <- cleanNAForAnalysis(esetClean, "PYc")
esetClean <- cleanNAForAnalysis(esetClean, "RIN")
esetClean <- removeFactorLevel(esetClean, "COPD2_R7", "DK")
esetClean <- removeFactorLevel(esetClean, "FinalCaDXc", "DK")
esetClean <- removeFactorLevel(esetClean, "COPD2_R7", "DK")
esetClean <- removeFactorLevel(esetClean, "GENDERc", "DK")

esetClean <- calcIndicator(esetClean, "FinalCaDXc", "COPD2_R7")
esetClean$smkindic <- as.numeric(as.character(esetClean$indicator))
esetClean$smkindic[esetClean$SMKc==2] <- esetClean$smkindic[esetClean$SMKc==2] + 4
esetClean$smkindic <- as.factor(esetClean$smkindic)

# Define the GOLD Stage appropriate for all patients
esetClean$GOLD <- factor(x=rep(0, sampleNumber(esetClean)), levels=c("0","1","2","3","4"))
# GOLD Stage 1 Ratio < 0.7, FEV1 >= 8
esetClean$GOLD[esetClean$RATIOc < 0.7 & esetClean$FEV1Pc >= 0.8] <- 1
# GOLD Stage 2 Ratio < 0.7, 50 <= FEV1 < 80
esetClean$GOLD[esetClean$RATIOc < 0.7 & esetClean$FEV1Pc < 0.8] <- 2
# GOLD Stage 3 Ratio < 0.7, 30 <= FEV1 <= 50
esetClean$GOLD[esetClean$RATIOc < 0.7 & esetClean$FEV1Pc < 0.5] <- 3
# GOLD Stage 4 Ratio < 0.7, FEV1 < 30%
esetClean$GOLD[esetClean$RATIOc < 0.7 & esetClean$FEV1Pc < 0.3] <- 4

# Generate a super clean dataset devoid of all patients with other pulmonary diseases
esetSuperClean <- esetClean
esetSuperClean <- removeFactorLevel(esetSuperClean, "AllegroPNAc", "1")
esetSuperClean <- removeFactorLevel(esetSuperClean, "AllegroTBc", "1")
esetSuperClean <- removeFactorLevel(esetSuperClean, "AllegroSarcoidc", "1")
esetSuperClean <- removeFactorLevel(esetSuperClean, "AllegroIPFc", "1")
esetSuperClean <- removeFactorLevel(esetSuperClean, "AllegroIPFc", "DK")
esetSuperClean <- removeFactorLevel(esetSuperClean, "AllegroAtelectasisc", "1")
esetSuperClean <- removeFactorLevel(esetSuperClean, "AllegroAtelectasisc", "DK")
esetSuperClean <- removeFactorLevel(esetSuperClean, "AllegroAsthmac", "DK")
esetSuperClean <- removeFactorLevel(esetSuperClean, "AllegroAsthmac", "1")

# clean up ATF4 data
varLabels(atf4_data) <- "SampleID"
atf4_data$SampleID[grep("ATF4", atf4_data$SampleID)] <- "ATF4"
atf4_data$SampleID[grep("Ctrl", atf4_data$SampleID)] <- "Control"
atf4_data$SampleID <- as.factor(atf4_data$SampleID)


```


```{r modelCreation, eval=TRUE, echo=TRUE, results='hide'}

# Katie uses age, sex, smoking, and pack years
# She also attempts to account for corticosteroids by removing them, repeating
# the analysis and checking for enrichment in the overlapping genes


fdrVals <- c(0.05, 0.1, 0.2)
intrxA <- list()
intrxB <- list()
intrxC <- list()
intrxGenes <- list()

#eset <- medianFilter(esetSuperClean)
eset <- medianFilter(removeFactorLevel(esetSuperClean, "SMKc", "1"))
#eset <- medianFilter(esetClean)
for(i in 1:length(fdrVals)){
  
	intrxA[[i]] <- lmFitWrapper(eset, c("COPD2_R7", "FinalCaDXc", "AGEcalc",
                                     "GENDERc", "PYc", "RIN",
                                    "COPD2_R7*FinalCaDXc"),
                             name="COPD Signal",
                             adjust.method="fdr", p.value=fdrVals[i],
                             varOfInterest=7)
                             
	intrxB[[i]] <- lmFitWrapper(eset, c("FEV1Pc", "FinalCaDXc", "AGEcalc",
                                     "GENDERc", "PYc", "RIN",
                                     "FEV1Pc*FinalCaDXc"),
                             name="COPD Signal",
                             adjust.method="fdr", p.value=fdrVals[i],
                             varOfInterest=7)

	intrxC[[i]] <- lmFitWrapper(eset, c("RATIOc", "FinalCaDXc", "AGEcalc",
                                     "GENDERc", "PYc", "RIN",
                                     "RATIOc*FinalCaDXc"),
                             name="COPD Signal",
                             adjust.method="fdr", p.value=fdrVals[i],
                             varOfInterest=7)

	overlappingGenes <- intrxA[[i]]$geneSymbols[intrxA[[i]]$geneSymbols %in% intrxB[[i]]$geneSymbols]
	intrxGenes[[i]] <- overlappingGenes[overlappingGenes %in% intrxC[[i]]$geneSymbols]

	length(intrxA[[i]]$geneSymbols)
	length(intrxB[[i]]$geneSymbols)
	length(intrxC[[i]]$geneSymbols)
	length(intrxGenes[[i]])
	
}


# generate ATF4 model(s)
atf4Model <- lmFitWrapper(atf4_data, c("SampleID"), name="ATF4 Perturbation Data", adjust.method="fdr",
                          p.value=0.05, varOfInterest=1)

# define a model for comparing COPD and COPD+Cancer from which a gene set and ranked list can be extracted. Vars of interest will be primarily cancer
esetCC <- removeFactorLevel(esetClean, "COPD2_R7", "0")
esetCC <- medianFilter(esetCC)
ccModel <- lmFitWrapper(esetCC, c("FinalCaDXc", "AGEcalc", "SMKc", "GENDERc", "PYc", "RIN"),
                        name="Investigating cancer signal in COPD patients",
                        adjust.method="fdr", p.value=0.1, varOfInterest=1)
```

```{r GSEAListGeneration}

# COPD gene sets
tempResults <- decideTests(intrxA[[1]]$fit, adjust.method="fdr", p.value=0.0001)

esetCOPD <- intrxA[[1]]$eset
esetCOPD <- removeFactorLevel(esetCOPD, "FinalCaDXc", "1")
clabels <- cbind(copd_colors[esetCOPD$COPD2_R7], smoking_colors[esetCOPD$SMKc])

# define the genes up with COPD
upCOPD <- which(tempResults[, 2] > 0)
upCOPD100 <- match(names(head(sort(intrxA[[1]]$fit$t[, 2], decreasing=TRUE), n=100)), rownames(intrxA[[1]]$fit$t))

# define the genes down with COPD
dnCOPD <- which(tempResults[, 2] < 0)
dnCOPD100 <- match(names(head(sort(intrxA[[1]]$fit$t[, 2], decreasing=FALSE), n=100)), rownames(intrxA[[1]]$fit$t))

# Cancer gene sets
# define the top 100 genes down in cancer
dnCancer100 <- match(names(head(sort(intrxA[[1]]$fit$t[, 3], decreasing=FALSE), n=100)), rownames(intrxA[[1]]$fit$t))

# define the top 100 genes up in cancer
upCancer100 <- match(names(head(sort(intrxA[[1]]$fit$t[, 3], decreasing=TRUE), n=100)), rownames(intrxA[[1]]$fit$t))

# define the genes up in COPD+Cancer vs COPD
# by fdr < 0.1
upCCvCOPD <- which(ccModel$results[, 2] > 0)

# top 100
upCCvCOPD100 <- match(names(head(sort(ccModel$fit$t[, 2], decreasing=TRUE), n=100)), rownames(ccModel$fit$t))

# define the genes down in COPD+Cancer vs COPD
# by fdr < 0.1
dnCCvCOPD <- which(ccModel$results[, 2] < 0)

# top 100
dnCCvCOPD100 <- match(names(tail(sort(ccModel$fit$t[, 2], decreasing=TRUE), n=100)), rownames(ccModel$fit$t))

# generate mean t-statistic ranked list for intrxA-C models


```

```{r GSEAListVisualization}

# Create heatmap visualizations for the top up and down genes sets in COPD v Normal only
# create a heatmap of these genes in the COPD and normal patients
heatmap3(exprs(esetCOPD)[upCOPD, ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = esetCOPD$COPD2_R7, ColSideColors = clabels,
         main = "Genes up with COPD in COPD and normal patients",
         labCol="")
# create a heatmap of these genes in the COPD and normal patients
heatmap3(exprs(esetCOPD)[dnCOPD, ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = esetCOPD$COPD2_R7, ColSideColors = clabels,
         main = "Genes down with COPD in COPD and normal patients",
         labCol="")

# create heatmap of the overlapping interaction genes
intrxGenes1 <- match(intrxGenes[[1]], intrxA[[1]]$fit$genes$Symbol)
clabels <- cbind(copdca_colors[intrxA[[1]]$eset$indicator])
heatmap3(exprs(intrxA[[1]]$eset)[intrxGenes1, ], col=bluered, 
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering=intrxA[[1]]$eset$indicator, ColSideColors=clabels,
         main="Triple overlapping genes at fdr < 0.05", labCol="")


```

```{r GSEAListOutput}
# save the top 100 down and up genes for cancer t-statistic
saveGeneSet(intrxA[[1]]$fit, inds=dnCancer100, filename="intrxA_top100_Cancer_dn_esetClean_allSmokers", geneSetName="dnCancer100", description="Top 100 Genes with -t for Cancer Main Effect")
saveGeneSet(intrxA[[1]]$fit, inds=upCancer100, filename="intrxA_top100_Cancer_up_esetClean_allSmokers", geneSetName="upCancer100", description="Top 100 Genes with +t for Cancer Main Effect")

# Cancer ranked list
saveRankedList(intrxA[[1]]$fit, varColInd=3, filename="intrxA_esetClean_allSmokers")

# Define ATF4 up and down gene sets, and ATF4 ranked list
# Start with ranked list - as Katie did
saveRankedList(atf4Model$fit, varColInd=2, filename="atf4_esetClean_allSmokers")

# save the gene set for down in COPD
saveGeneSet(intrxA[[1]]$fit, inds=dnCOPD, filename="intrxA_fdr0001_COPD_dn_esetClean_allSmokers",
            geneSetName="dnCOPD", description="Genes w/ -t for COPD Main Effect")

# save the 100 down gene set for COPD
saveGeneSet(intrxA[[1]]$fit, inds=dnCOPD100, filename="intrxA_top100_COPD_dn_esetClean_allSmokers", geneSetName="dnCOPD100", description="Top 100 Genes with -t for COPD Main Effect")

# COPD, [FEV1, Ratio] ranked lists
saveRankedList(intrxA[[1]]$fit, varColInd=2, filename="intrxA_esetClean_allSmokers")

# save the gene set for up in COPD
saveGeneSet(intrxA[[1]]$fit, inds=upCOPD, filename="intrxA_fdr0001_COPD_up_esetClean_allSmokers",
            geneSetName="upCOPD", description="Genes w/ +t for COPD Main Effect")

# save the 100 up gene set for COPD
saveGeneSet(intrxA[[1]]$fit, inds=upCOPD100, filename="intrxA_top100_COPD_up_esetClean_allSmokers", geneSetName="upCOPD100", description="Top 100 Genes with +t for COPD Main Effect")


# save the genes up in COPD+Cancer vs COPD
# by fdr < 0.1
saveGeneSet(ccModel$fit, inds=upCCvCOPD, filename="ccModel_fdr01_COPDCa_up_v_COPD_esetClean_allSmokers", geneSetName="upCOPDCavCOPD", description="Top Genes at fdr < 0.01 up with COPDCa vs COPD")

# top 100
saveGeneSet(ccModel$fit, inds=upCCvCOPD100, filename="ccModel_top100_COPDCa_up_v_COPD_esetClean_allSmokers", geneSetName="upCOPDCavCOPD100", description="Top 100 Genes up with COPDCa vs COPD")

# save the genes down in COPD+Cancer vs COPD
# by fdr < 0.1
saveGeneSet(ccModel$fit, inds=dnCCvCOPD, filename="ccModel_fdr01_COPDCa_dn_v_COPD_esetClean_allSmokers", geneSetName="dnCOPDCavCOPD", description="Top Genes at fdr < 0.01 down with COPDCa vs COPD")

# top 100
saveGeneSet(ccModel$fit, inds=dnCCvCOPD100, filename="ccModel_top100_COPDCa_dn_v_COPD_esetClean_allSmokers", geneSetName="dnCOPDCavCOPD100", description="Top 100 Genes down with COPDCa vs COPD")

# save a ranked list for COPDCancer v COPD
saveRankedList(ccModel$fit, varColInd=2, filename="ccModel_COPDCavCOPD_esetClean_allSmokers")

```

```{r emtVisualization}
emt_genes$EMT_Genes

# generate model just for pulling out gene symbols from fit object
esetEMT <- esetClean
emtModel <- lmFitWrapper(esetEMT, c("FinalCaDXc"),
                        name="Model for gene symbols",
                        adjust.method="fdr", p.value=0.05, varOfInterest=1)

emtInds <- match(emt_genes$EMT_Genes, emtModel$fit$genes$Symbol)
emtInds <- emtInds[!is.na(emtInds)]

esetEMT <- removeFactorLevel(esetEMT, "FinalCaDXc", "1")

clabels <- cbind(GOLD_colors[esetEMT$GOLD])
emtClusts <- return_cluster(emtInds, esetEMT, n.clusters=3, mthd="ward.D")

heatmap3(exprs(esetEMT)[emtInds, ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = "unsupervised", ColSideColors = clabels,
         main = "EMT Genes",
         labCol="", RowSideColors=as.factor(emtClusts))


c1 <- match(names(emtClusts[emtClusts==1]), rownames(emtModel$fit$genes))
c2 <- match(names(emtClusts[emtClusts==2]), rownames(emtModel$fit$genes))
c3 <- match(names(emtClusts[emtClusts==3]), rownames(emtModel$fit$genes))

# cluster 1 - down in COPD subjectively
heatmap3(exprs(esetEMT)[c1, ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = "unsupervised", ColSideColors = clabels,
         main = "EMT Genes Cluster 1 in COPD Patients",
         labCol="")

# cluster 2 - up in COPD subjectively
heatmap3(exprs(esetEMT)[c2, ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = "unsupervised", ColSideColors = clabels,
         main = "EMT Genes Cluster 2 in COPD Patients",
         labCol="")

# cluster 3 - up in COPD subjectively
heatmap3(exprs(esetEMT)[c3, ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = "unsupervised", ColSideColors = clabels,
         main = "EMT Genes Cluster 3 in COPD Patients",
         labCol="")

# also look at PCA plots for PC1 v PC2 for these clusters




```


```{r saveEMTClusters}

saveGeneSet(emtModel$fit, inds=c1, filename="emt_cluster1_downInCOPD", geneSetName="EMTCluster1DowninCOPD", description="Cluster 1 Set of Genes from Byers 2013 down in COPD")

saveGeneSet(emtModel$fit, inds=c2, filename="emt_cluster2_upInCOPD", geneSetName="EMTCluster2UpinCOPD", description="Cluster 2 Set of Genes from Byers 2013 up in COPD")

saveGeneSet(emtModel$fit, inds=c3, filename="emt_cluster3_upInCOPD", geneSetName="EMTCluster3UpinCOPD", description="Cluster 3 Set of Genes from Byers 2013 up in COPD")

saveGeneSet(emtModel$fit, inds=emtInds, filename="emt_all_Byers", geneSetName="EMTAllByers", description="Genes from Byers EMT Paper")

```


```{r ByersMethodEMT}
# Byers method: looking at genes correlated with EMT markers that are bimodally distributed (not done)
# expression levels correlated with positively or negatively with the following EMT genes:
# CDH1, VIM, CDH2, FN1
emtMarkers <- c("CDH1", "VIM", "CDH2", "FN1")
emtMarkInds <- match(emtMarkers, emtModel$fit$genes$Symbol)

# check that they are right
featureNames(emtModel$eset)[emtMarkInds]
# these are the correct rows for the EMT marker genes

# go through each of the marker genes and define correlations with each of the other genes in the array
emtCorrs <- matrix(nrow=featureNumber(esetEMT), ncol=length(emtMarkInds))
for(i in 1:length(emtMarkInds)){
  for(j in 1:featureNumber(esetEMT)){
    emtCorrs[j, i] <- cor(exprs(esetEMT)[emtMarkInds[i], ], exprs(esetEMT)[j, ]) 
  }
}

# visualize each of the correlation sets and all of them together
for(i in 1:length(emtMarkInds)){
  hist(emtCorrs[, i], main=paste("Correlations with", emtMarkers[i], sep=" "))
  
}
hist(emtCorrs, main=paste("Correlations with all of EMT Markers"))

# calculate empirical p values for each set of correlations
p1 <- sum(emtCorrs[, 1] > 0.6)/length(emtCorrs[, 1])
p2 <- sum(emtCorrs[, 2] > 0.6)/length(emtCorrs[, 2])


# for ease of use generate absolute values of emt correlations
emtCorrsAbs <- abs(emtCorrs)

emtNewInds <- list()
for(i in 1:length(emtMarkInds)){
  emtNewInds[[i]] <- which(emtCorrsAbs[, i] > 0.6)
  
  
}
emtNewInds <- apply(emtCorrsAbs, MARGIN=2, FUN=function(x){which(x > 0.55)})

# include only those with bimodal distributions (increases likelihood of class separation)

allNEIs <-  unique(unlist(emtNewInds))

clabels <- cbind(copd_colors[esetEMT$COPD2_R7], smoking_colors[esetEMT$SMKc])
# heatmap of all identified genes
heatmap3(exprs(esetEMT)[allNEIs, ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = "unsupervised", ColSideColors = clabels,
         main = "EMT Genes",
         labCol="")

# heatmap of each set of genes individually
heatmap3(exprs(esetEMT)[emtNewInds[[1]], ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = "unsupervised", ColSideColors = clabels,
         main = paste("EMT Genes:", emtMarkers[1]),
         labCol="")

heatmap3(exprs(esetEMT)[emtNewInds[[2]], ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = "unsupervised", ColSideColors = clabels,
         main = paste("EMT Genes:", emtMarkers[2]),
         labCol="")

heatmap3(exprs(esetEMT)[emtNewInds[[3]], ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = "unsupervised", ColSideColors = clabels,
         main = paste("EMT Genes:", emtMarkers[3]),
         labCol="")

heatmap3(exprs(esetEMT)[emtNewInds[[4]], ], col = bluered,
         hclustfun=function(d) hclust(d, method="ward.D"),
         col.clustering = "unsupervised", ColSideColors = clabels,
         main = paste("EMT Genes:", emtMarkers[4]),
         labCol="")



# for later - should figure out how to actually pull down the gene symbols without using lmFit
#library(biomaRt)
#mart <- useMart("ensembl")
#mart <- useDataset("hsapiens_gene_ensembl", mart=mart)


```
